# CPU是如何执行程序的？
图灵机，纸带为存储，读写头包含控制部分，运算部分，存储部分。
- 冯 诺伊曼架构仿照图灵机设计了：输入输出设备（外设），存储单元（存储结构），逻辑运算单元，控制单元（CPU内部）五部分。
- CPU
分为32位和64位CPU，主要区别在于一次能计算多少个字节。
32位为4字节，64位为8字节。大的位宽可以一次进行更加大的数据的运算。
寄存器在cpu和内存之间。方便快速获取数据。
寄存器种类：
-- 通用寄存器，存放运算数据。结果和待运算数据。
-- 程序计数器PC，存放下一跳指令内存地址，（不是跳转指令就默认自增当前指令所长字节来寻找下一跳指令的地址）
-- 指令寄存器，存放当前指令
- 总线
-- 地址总线：和内存相连，指定CPU的操作的内存地址。
-- 数据总线： 读写内存的数据。
-- 控制总线：发送和接收信号，中断，设备复位等。。
三者关系，cpu读写内存数据，地址总线找到对应的内存地址，数据总线传输读写数据，控制总线这里可控制读/写操作。
- 输入/输出设备
数据输入（键盘，需要中断，需要控制总线）。输出设备负责数据输出。
- 线路位宽与CPU位宽
线路通过高低电平传输数据，表示1/0；为了避免数据传输是串行传输的低效率方式，需要增加线路进行并行传输。
线宽和cpu位宽不一样，线宽表示可以一次并行传输的数据位数。==一般来说cpu的位宽不要小于线路位宽，最好相等匹配==。
**64位cpu可以一次性算出两个64位数字的结果，而32位cpu则需要多次计算。正常情况下64位和32位没有什么区别，只有计算超过32位数字，64位又是才体现出来。同样64位cpu带来的还有地址总线的扩大，可访问内存范围增大**
# 程序执行的基本过程
程序是一个指令的顺序集合。
cpu读取当前PC指向的内存地址，并将该地址数据通过数据总线回传到指令寄存器。PC自增当前指令的长度/跳转指令则指向对应的指令内存地址。cpu分析指令类型为计算指令还是存储指令进行对应的操作。
对于add = 1 + 2来说，其对应的数据和代码细节：
![image-20240207143340803](硬件结构和操作系统结构/image-20240207143340803.png)
# 指令
针对MIPS指令集指令分为I R J三种指令，有很多种类。
下面是IRJ三种指令对应的位数：
![image-20240207165309863](硬件结构和操作系统结构/image-20240207165309863.png)
- R指令：操作码/功能码扩展标识指令类型，一般为算数逻辑指令，包含逻辑运算。位移量是数据的偏移计算使用。
- I指令：数据传输，条件分支常用。无位移量和功能码，无第三个寄存器。合并成一个地址值或者立即数。
- J指令：用于指令跳转，高6位外的26位都是一个跳转的地址。
**流水线方式**：
分为四个过程，即指令周期：
- 取指操作，通过程序计数器PC获取对应内存地址的指令。由控制器进行操作。
- cpu进行指令的解码。控制器进行
- cpu执行指令。运算器进行处理。地址跳转等J型指令只需要控制器不需要运算器。
- cpu将结果写回寄存器或者是将寄存器值写回内存。
![image-20240220183808744](硬件结构和操作系统结构/image-20240220183808744.png)
# 指令类型
数据传输：store，load 寄存器与内存数据传输的指令，mov将一个内存地址的数据移动到另一个内存地址。
运算类型指令：加减乘除，位运算，比较大小等，他们最多只能处理两个寄存器中的数据。
跳转类型的指令：